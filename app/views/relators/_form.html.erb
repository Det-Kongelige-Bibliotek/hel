<% remote ||= false %>


<script>
    $(function () {

        var agents = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.whitespace,
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
                url: 'http://localhost:3000/solrwrapper/%QUERY',
                wildcard: '%QUERY'
            }

        });

        $(".agent-typeahead").typeahead({
            minLength: 1,
            highlight: true },
        {
            name: 'Agents',
            source: agents,
            displayKey: 'val',
            templates: {
                empty: '<div class="empty-message">We should do somthing with empty results</div>'
            }
        }).bind('typeahead:select', function(event, suggestion) {
            $(event.target).parent().parent().parent().find("input[id$='agent_id']").val(suggestion.id);
        });

    });
</script>


<%= builder.simple_fields_for :relators, defaults: { wrapper_html: { class: 'form-group' },
                                                       input_html: { class: 'form-control' }
                                         } do |rel_fields| %>
    <div class="row relator_fields">
      <div class="col-sm-12">
        <div class="input string optional work_relators_agent_name col-sm-6">
          <label class="string optional" for="work_relators_attributes_0_agent_label">Agent Navn</label>
          <input class="string optional form-control agent-typeahead" name="work[blah][]" id="work_relators_attributes_0_agent_label" type="text">
        </div>
        <%= rel_fields.hidden_field :agent_id, wrapper_html: { class: 'col-sm-6' } %>
        <%= rel_fields.input :role, collection: get_list_with_labels('Relators'), input_html: { class: 'combobox'}, wrapper_html: { class: 'col-sm-2' }  %>
      </div>
    </div>
<% end %>